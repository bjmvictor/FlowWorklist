{% extends "base.html" %}

{% block content %}
<div class="space-y-8">
  <!-- Config Header -->
  <div class="flex items-center gap-3 mb-8">
    <i class="fas fa-cog text-3xl text-blue-500"></i>
    <h2 class="text-4xl font-bold" data-i18n="config">Configuration</h2>
  </div>

  <!-- Configuration Card -->
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8">
    <form method="post" class="space-y-8">
      
      <!-- SERVER SECTION -->
      <div class="border-b dark:border-gray-700 pb-8">
        <h3 class="text-2xl font-bold mb-6 flex items-center gap-3">
          <i class="fas fa-server text-blue-500"></i>
          <span data-i18n="server_settings">CONFIGURA√á√ïES DO SERVIDOR</span>
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- AE Title -->
          <div>
            <label class="block text-lg font-semibold mb-3">
              <i class="fas fa-tag text-blue-500 mr-2"></i>
              <span data-i18n="aet_title">AE Title</span>
            </label>
            <input 
              type="text" 
              name="server_aet" 
              value="{{ cfg.get('server', {}).get('aet', 'MWLSCP') }}"
              placeholder="MWLSCP"
              class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:border-blue-500 dark:bg-gray-700 dark:text-white transition"
            >
            <p class="text-xs text-gray-500 dark:text-gray-400 mt-2" data-i18n="aet_title_full">DICOM Application Entity Title</p>
          </div>

          <!-- Host -->
          <div>
            <label class="block text-lg font-semibold mb-3">
              <i class="fas fa-network-wired text-blue-500 mr-2"></i>
              <span data-i18n="host">Host/IP</span>
            </label>
            <input 
              type="text" 
              name="server_host" 
              value="{{ cfg.get('server', {}).get('host', '0.0.0.0') }}"
              placeholder="0.0.0.0"
              class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:border-blue-500 dark:bg-gray-700 dark:text-white transition"
            >
            <p class="text-xs text-gray-500 dark:text-gray-400 mt-2" data-i18n="listen_all_interfaces">Listen on all interfaces</p>
          </div>

          <!-- Port -->
          <div>
            <label class="block text-lg font-semibold mb-3">
              <i class="fas fa-plug text-blue-500 mr-2"></i>
              <span data-i18n="port">Porta</span>
            </label>
            <input 
              type="number" 
              name="server_port" 
              value="{{ cfg.get('server', {}).get('port', 11112) }}"
              class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:border-blue-500 dark:bg-gray-700 dark:text-white transition"
            >
            <p class="text-xs text-gray-500 dark:text-gray-400 mt-2" data-i18n="server_port_full">DICOM server port</p>
          </div>

          <!-- Client AE Title -->
          <div>
            <label class="block text-lg font-semibold mb-3">
              <i class="fas fa-user-shield text-blue-500 mr-2"></i>
              <span data-i18n="client_aet">Client AE</span>
            </label>
            <input 
              type="text" 
              name="server_client_aet" 
              value="{{ cfg.get('server', {}).get('client_aet', 'Prima') }}"
              placeholder="Prima"
              class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:border-blue-500 dark:bg-gray-700 dark:text-white transition"
            >
            <p class="text-xs text-gray-500 dark:text-gray-400 mt-2" data-i18n="client_aet_title_full">Expected client AE Title</p>
          </div>
        </div>
      </div>

      <!-- DATABASE SECTION -->
      <div class="border-b dark:border-gray-700 pb-8">
        <h3 class="text-2xl font-bold mb-6 flex items-center gap-3">
          <i class="fas fa-database text-green-500"></i>
          <span data-i18n="database_settings">CONFIGURA√á√ïES DO BANCO DE DADOS</span>
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Type -->
          <div>
            <label class="block text-lg font-semibold mb-3">
              <i class="fas fa-cogs text-green-500 mr-2"></i>
              <span data-i18n="database_type">Tipo</span>
            </label>
            <select 
              name="database_type" 
              class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:border-green-500 dark:bg-gray-700 dark:text-white transition"
            >
              <option value="oracle" {% if cfg.get('database', {}).get('type', 'oracle') == 'oracle' %}selected{% endif %}>Oracle</option>
              <option value="postgres" {% if cfg.get('database', {}).get('type', 'oracle') == 'postgres' %}selected{% endif %}>PostgreSQL</option>
              <option value="mysql" {% if cfg.get('database', {}).get('type', 'oracle') == 'mysql' %}selected{% endif %}>MySQL</option>
            </select>
          </div>

          <!-- DSN -->
          <div>
            <label class="block text-lg font-semibold mb-3">
              <i class="fas fa-location-dot text-green-500 mr-2"></i>
              <span data-i18n="database_dsn">DSN</span>
            </label>
            <input 
              type="text" 
              name="database_dsn" 
              value="{{ cfg.get('database', {}).get('dsn', '') }}"
              placeholder="192.168.1.3:1521/PRD"
              class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:border-green-500 dark:bg-gray-700 dark:text-white transition"
            >
            <p class="text-xs text-gray-500 dark:text-gray-400 mt-2" data-i18n="dsn_hint">Formato: IP:PORTA/DB (ex.: 192.168.1.3:1521/PRD)</p>
          </div>

          <!-- User -->
          <div>
            <label class="block text-lg font-semibold mb-3">
              <i class="fas fa-user text-green-500 mr-2"></i>
              <span data-i18n="database_user">Usu√°rio</span>
            </label>
            <input 
              type="text" 
              name="database_user" 
              value="{{ cfg.get('database', {}).get('user', '') }}"
              placeholder="db_weknow"
              class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:border-green-500 dark:bg-gray-700 dark:text-white transition"
            >
          </div>

          <!-- Password -->
          <div>
            <label class="block text-lg font-semibold mb-3">
              <i class="fas fa-lock text-green-500 mr-2"></i>
              <span data-i18n="database_password">Senha</span>
            </label>
            <input 
              type="password" 
              name="database_password" 
              value="{{ cfg.get('database', {}).get('password', '') }}"
              class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:border-green-500 dark:bg-gray-700 dark:text-white transition"
            >
          </div>
        </div>

        <!-- SQL Query -->
        <div class="mt-6">
          <label class="block text-lg font-semibold mb-3">
            <i class="fas fa-code text-green-500 mr-2"></i>
            <span data-i18n="database_query">Query</span>
          </label>
          <textarea 
            name="database_query" 
            rows="8"
            placeholder="SELECT ... FROM ..."
            class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:border-green-500 dark:bg-gray-700 dark:text-white transition font-mono text-sm"
          >{{ cfg.get('database', {}).get('query', '') }}</textarea>
          <p class="text-xs text-gray-500 dark:text-gray-400 mt-2" data-i18n="sql_hint">Consulta SQL que retorna os itens da Worklist</p>

          <!-- Guia de colunas esperadas -->
          <div class="mt-4 bg-blue-50 dark:bg-gray-700 border border-blue-200 dark:border-gray-600 rounded-lg p-4">
            <p class="font-semibold mb-2 text-blue-800 dark:text-blue-200" data-i18n="sql_guide_title">Guia de colunas esperadas pela Worklist</p>
            <div class="text-xs text-gray-700 dark:text-gray-300 space-y-1 max-h-64 overflow-y-auto">
              <p class="font-bold text-blue-600 dark:text-blue-300" data-i18n="sql_guide_warning">‚ö†Ô∏è Query deve retornar EXATAMENTE 17 colunas nesta ordem:</p>
              <p><code class="font-mono bg-gray-200 dark:bg-gray-600 px-1 rounded">1.</code> <strong>PatientName</strong> <span data-i18n="sql_col1_hint">(Nome completo do paciente)</span> - Ex: JOAO DA SILVA</p>
              <p><code class="font-mono bg-gray-200 dark:bg-gray-600 px-1 rounded">2.</code> <strong>PatientID</strong> <span data-i18n="sql_col2_hint">(Identificador √∫nico)</span> - Ex: 12345678</p>
              <p><code class="font-mono bg-gray-200 dark:bg-gray-600 px-1 rounded">3.</code> <strong>PatientBirthDate</strong> (YYYYMMDD) - Ex: 19751025</p>
              <p><code class="font-mono bg-gray-200 dark:bg-gray-600 px-1 rounded">4.</code> <strong>PatientSex</strong> (M/F/O) - Ex: M</p>
              <p><code class="font-mono bg-gray-200 dark:bg-gray-600 px-1 rounded">5.</code> <strong>RequestedProcedureDescription</strong> <span data-i18n="sql_col5_hint">(Descri√ß√£o do exame)</span> - Ex: RX TORAX PA</p>
              <p><code class="font-mono bg-gray-200 dark:bg-gray-600 px-1 rounded">6.</code> <strong>AccessionNumber</strong> <span data-i18n="sql_col6_hint">(N√∫mero do pedido)</span> - Ex: P102025</p>
              <p><code class="font-mono bg-gray-200 dark:bg-gray-600 px-1 rounded">7.</code> <strong>ScheduledProcedureStepStartDate</strong> (YYYYMMDD) - Ex: 20251216</p>
              <p><code class="font-mono bg-gray-200 dark:bg-gray-600 px-1 rounded">8.</code> <strong>ScheduledProcedureStepStartTime</strong> (HHMMSS) - Ex: 143000</p>
              <p><code class="font-mono bg-gray-200 dark:bg-gray-600 px-1 rounded">9.</code> <strong>ScheduledPerformingPhysicianName</strong> <span data-i18n="sql_col9_hint">(Nome completo do m√©dico)</span> - Ex: MARY JONES</p>
              <p><code class="font-mono bg-gray-200 dark:bg-gray-600 px-1 rounded">10.</code> <strong>Modality</strong> (CR/CT/MR/US) - Ex: CR</p>
              <p><code class="font-mono bg-gray-200 dark:bg-gray-600 px-1 rounded">11.</code> <strong>Priority</strong> - Ex: HIGH, MEDIUM, LOW</p>
              <p><code class="font-mono bg-gray-200 dark:bg-gray-600 px-1 rounded">12.</code> <strong>Encounter Type</strong> <span data-i18n="sql_col12_hint">(Tipo de atendimento)</span> - Ex: URGENCY, INTERNAL</p>
              <p><code class="font-mono bg-gray-200 dark:bg-gray-600 px-1 rounded">13.</code> <strong>Encounter ID</strong> <span data-i18n="sql_col13_hint">(ID do atendimento)</span> - Ex: 456789</p>
              <p><code class="font-mono bg-gray-200 dark:bg-gray-600 px-1 rounded">14.</code> <strong>Location</strong> <span data-i18n="sql_col14_hint">(Local do exame)</span> - Ex: EMERGENCY ROOM</p>
              <p><code class="font-mono bg-gray-200 dark:bg-gray-600 px-1 rounded">15.</code> <strong>Procedure Code</strong> <span data-i18n="sql_col15_hint">(C√≥digo do procedimento)</span> - Ex: FCR0101-0000</p>
              <p><code class="font-mono bg-gray-200 dark:bg-gray-600 px-1 rounded">16.</code> <strong>Code Meaning</strong> <span data-i18n="sql_col16_hint">(Significado do c√≥digo)</span> - Ex: CHEST X-RAY</p>
              <p><code class="font-mono bg-gray-200 dark:bg-gray-600 px-1 rounded">17.</code> <strong>Code Scheme</strong> <span data-i18n="sql_col17_hint">(Esquema de codifica√ß√£o)</span> - Ex: 99UNIT, CBR, SNOMED</p>
              <p class="mt-3 pt-2 border-t border-blue-300 dark:border-gray-500 text-blue-700 dark:text-blue-300">
                üìñ <a href="https://github.com/bjmvictor/FlowWorklist/blob/main/SQL_QUERY_GUIDE.md" target="_blank" class="underline hover:text-blue-900 dark:hover:text-blue-100" data-i18n="sql_guide_link">Ver guia completo com exemplos SQL</a>
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Buttons -->
      <div class="flex gap-4 justify-end pt-6">
        <a 
          href="/" 
          class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-8 rounded-lg transition flex items-center gap-2"
        >
          <i class="fas fa-times"></i>
          <span data-i18n="back">Back</span>
        </a>
        <button 
          type="submit" 
          class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg transition flex items-center gap-2"
        >
          <i class="fas fa-save"></i>
          <span data-i18n="save">Save</span>
        </button>
      </div>
    </form>
  </div>
</div>
{% endblock %}
